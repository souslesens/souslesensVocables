var csv_crawler = require("../_csvCrawler..js");

/*
DECLARE @g geometry;
SET @g = geometry::STLineFromText('LINESTRING (72.16200 96.97550,72.18800 96.97550,72.57500 96.81850,72.58000 96.83950,72.72200 97.06750,72.75900 97.00250,72.67400 96.97550,72.74400 96.97050,72.14700 96.97050,72.15700 96.97050)', 0).MakeValid();

SELECT   a.tag AS tag1
FROM         dbo.geometry_equipments AS a
WHERE     (a.geo.STIntersects(@g) = 1)




SELECT code as tagId
  FROM [lifex_dalia_db].[dbo].[M_tag]
  INTERSECT
  select tag as tagId from [lifex_dalia_localisation].[dbo].[equipments_coord]
 */

csv_crawler.readCsv({ filePath: "D:\\NLP\\ontologies\\LIFEX_DALIA\\localisation\\pipesDALIA.csv" }, null, function (err, result) {
    var x = result;

    var newData = [];
    var output = "";
    result.data.forEach(function (lines) {
        lines.forEach(function (line) {
            try {
                var model = line.model;

                var modelJson = JSON.parse(line.model);
                var segments = modelJson.list;

                //LINESTRING (100 100, 20 180, 180 180)
                var str = "";
                segments.forEach(function (segment, index) {
                    if (index > 0) str += ",";
                    str += ("" + segment[0]).substring(0, 8) + " " + ("" + segment[1]).substring(0, 8);
                });

                output += line.id + "\t" + "LINESTRING (" + str + ")\n";
            } catch (e) {
                console.log(line.model);
            } //"{\"type\":\"AxisAlignedList\",\"list\":[[69.754003663599,101.95150244289599,114.89999695539001,72.192003663599,101.972502442896,114.92099695539001],[72.19700366359899,101.95150244289599,113.28199695539,72.21800366359899,101.972502442896,114.89399695539001],[72.211003663599,101.35450244289599,113.25599695539,72.767003663599,101.95750244289599,113.27699695539],[72.74700366359899,101.29650244289599,113.03199695539,72.93200366359899,101.40350244289598,113.13999695539],[72.74700366359899,101.32650244289599,113.04999695539,72.910003663599,101.37250244289599,113.11999695539001],[72.75900366359899,101.33950244289599,113.10899695539,72.78000366359899,101.36050244289599,113.24999695539],[72.722003663599,101.30250244289599,112.97299695539,72.817003663599,101.397502442896,112.99499695539001],[72.75900366359899,101.33950244289599,112.98099695539,72.78000366359899,101.36050244289599,113.06099695539001],[72.192003663599,101.932502442896,113.25099695539001,72.237003663599,101.977502442896,113.29199695539],[72.74100366359899,101.334502442896,113.23999695539,72.785003663599,101.379502442896,113.28199695539],[72.18200366359899,101.94650244289599,114.88399695539,72.22300366359899,101.977502442896,114.92599695539],[69.749003663599,101.954502442896,114.90299695539001,69.75900366359899,101.96950244289599,114.91799695539001]]}"
        });
    });

    var y = output;
});
